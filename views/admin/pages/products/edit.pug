extends ../../layout/default.pug
include ../../mixins/select-tree.pug

block main
  
  //- Page Header
  .d-flex.justify-content-between.align-items-center.mb-4
    div
      h2.fw-bold.mb-1
        i.bi.bi-pencil-square.me-2.text-warning
        | Chỉnh Sửa Sản Phẩm
      p.text-muted.mb-0 Cập nhật thông tin sản phẩm
    a.btn.btn-outline-secondary(href=`${prefixAdmin}/products`)
      i.bi.bi-arrow-left.me-2
      | Quay Lại

  //- Form
  form(
    action=`${prefixAdmin}/products/edit/${product._id}?_method=PATCH`
    method="POST"
    enctype="multipart/form-data"
    id="form-edit-product"
  )
    .row
      //- Left Column
      .col-lg-8
        //- Basic Info Card
        .card.mb-3.border-0.shadow-sm
          .card-header.bg-white
            h6.mb-0.fw-semibold
              i.bi.bi-info-circle.me-2
              | Thông Tin Cơ Bản
          .card-body
            //- Title
            .mb-3
              label.form-label.fw-semibold(for="title")
                | Tiêu đề sản phẩm
                span.text-danger *
              input.form-control(
                type="text"
                id="title"
                name="title"
                placeholder="Nhập tên sản phẩm..."
                value=product.title
              )
            //- Parent Category
            .mb-3
              label.form-label.fw-semibold(for="product-catefory_id")
                i.bi.bi-diagram-3.me-1
                | Danh mục sản phẩm
              select.form-select(
                id="product-category_id"
                name="product_category_id"
              )
                option(value="") -- Chọn danh mục cha --
                if listCategory
                  +select-tree(listCategory,0,product.product_category_id)
            //- Description
            .mb-3
              label.form-label.fw-semibold(for="desc") Mô tả chi tiết
              textarea.form-control.tinymce(
                id="desc"
                name="description"
                rows="5"
                placeholder="Nhập mô tả sản phẩm..."
              ) #{product.description}

        //- Pricing & Inventory Card
        .card.mb-3.border-0.shadow-sm
          .card-header.bg-white
            h6.mb-0.fw-semibold
              i.bi.bi-currency-dollar.me-2
              | Giá & Kho Hàng
          .card-body
            .row.g-3
              //- Price
              .col-md-4
                label.form-label.fw-semibold(for="price")
                  i.bi.bi-tag.me-1
                  | Giá bán
                  span.text-danger *
                .input-group
                  input.form-control(
                    type="number"
                    id="price"
                    name="price"
                    value=product.price
                    min="0"
                    step="0.01"
                    required
                  )
                  span.input-group-text $

              //- Discount
              .col-md-4
                label.form-label.fw-semibold(for="discount")
                  i.bi.bi-percent.me-1
                  | Giảm giá
                .input-group
                  input.form-control(
                    type="number"
                    id="discount"
                    name="discountPercentage"
                    value=product.discountPercentage
                    min="0"
                    max="100"
                  )
                  span.input-group-text %

              //- Stock
              .col-md-4
                label.form-label.fw-semibold(for="stock")
                  i.bi.bi-box.me-1
                  | Số lượng
                  span.text-danger *
                input.form-control(
                  type="number"
                  id="stock"
                  name="stock"
                  value=product.stock
                  min="0"
                  required
                )

      //- Right Column
      .col-lg-4
        //- Image Card
        .card.mb-3.border-0.shadow-sm
          .card-header.bg-white
            h6.mb-0.fw-semibold
              i.bi.bi-image.me-2
              | Hình Ảnh
          .card-body
            label.form-label.fw-semibold(for="thumbnail") Ảnh đại diện
            
            //- Current Image
            if product.thumbnail
              .mb-3.text-center
                p.text-muted.small Ảnh hiện tại:
                img.img-thumbnail.rounded(
                  src=product.thumbnail
                  alt=product.title
                  style="max-width: 200px"
                )
            .upload-image
              //- Upload Area
              .border.border-2.border-dashed.rounded.p-4.text-center.mb-3.bg-light
                input.d-none(
                  type="file"
                  id="thumbnail"
                  name="thumbnail"
                  accept="image/*"
                  upload-image-input
                )
                label.d-block(for="thumbnail" style="cursor: pointer")
                  i.bi.bi-cloud-upload.display-4.text-primary.d-block.mb-2
                  p.mb-1.fw-semibold Click để đổi ảnh
                  small.text-muted Kéo thả ảnh vào đây
                  br
                  small.text-muted PNG, JPG (Max: 2MB)
              
              //- Preview New Image
              .form-imagePreview.d-none.text-center
                button.btn-close(type="button" btn-remove-imagePreview)
                img.img-thumbnail.rounded(
                  src=""
                  alt="Preview"
                  upload-image-preview
                  style="max-width: 100%"
                )

        //- Settings Card
        .card.mb-3.border-0.shadow-sm
          .card-header.bg-white
            h6.mb-0.fw-semibold
              i.bi.bi-gear.me-2
              | Cài Đặt
          .card-body
            //- Position
            .mb-3
              label.form-label.fw-semibold(for="position")
                i.bi.bi-sort-numeric-down.me-1
                | Vị trí hiển thị
              input.form-control(
                type="number"
                id="position"
                name="position"
                min="1"
                value=product.position
              )

            //- Status
            .mb-3
              label.form-label.fw-semibold.d-block.mb-2
                i.bi.bi-check-circle.me-1
                | Trạng thái kho
              
              .form-check.border.rounded.p-3.mb-2
                input.form-check-input(
                  type="radio"
                  id="statusActive"
                  name="availabilityStatus"
                  value="In Stock"
                  checked=(product.availabilityStatus === "In Stock")
                )
                label.form-check-label.ms-2(for="statusActive")
                  i.bi.bi-check-circle-fill.text-success
                  |  Còn hàng

              .form-check.border.rounded.p-3
                input.form-check-input(
                  type="radio"
                  id="statusInActive"
                  name="availabilityStatus"
                  value="Low Stock"
                  checked=(product.availabilityStatus === "Low Stock")
                )
                label.form-check-label.ms-2(for="statusInActive")
                  i.bi.bi-exclamation-circle-fill.text-warning
                  |  Sắp hết

    //- Actions
    .card.border-0.shadow-sm.mt-4
      .card-body
        .d-flex.justify-content-between.align-items-center
          div
            a.btn.btn-outline-danger(href=`${prefixAdmin}/products`)
              i.bi.bi-x-circle.me-2
              | Hủy Bỏ
            button.btn.btn-outline-secondary.ms-2(
              type="button"
              onclick="history.back()"
            )
              i.bi.bi-arrow-left.me-2
              | Quay Lại
          
          button.btn.btn-warning.btn-lg.text-white(type="submit")
            i.bi.bi-check-circle.me-2
            | Cập Nhật Sản Phẩm

