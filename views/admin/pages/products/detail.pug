extends ../../layout/default.pug

block main
  //- Page Header
  .d-flex.justify-content-between.align-items-center.mb-4
    div
      h2.fw-bold.mb-1
        i.bi.bi-box.me-2.text-primary
        | Chi Tiết Sản Phẩm
      if product.slug
        p.text-muted.mb-0
          i.bi.bi-link-45deg.me-1
          | /#{product.slug}
    .d-flex.gap-2
      a.btn.btn-warning(href=`${prefixAdmin}/products/edit/${product.id}`)
        i.bi.bi-pencil.me-2
        | Chỉnh Sửa
      a.btn.btn-outline-secondary(href=`${prefixAdmin}/products`)
        i.bi.bi-arrow-left.me-2
        | Quay Lại

  .row
    //- Left Column - Product Info
    .col-lg-8
      //- Main Info Card
      .card.shadow-sm.mb-3
        .card-body
          if product.thumbnail
            .text-center.mb-4
              img.img-fluid.rounded.border(
                src=product.thumbnail
                alt=product.title
                style="max-height: 400px; object-fit: contain;"
              )
          
          if product.title
            h3.fw-bold.mb-3 #{product.title}
          
          .row.g-3.mb-4
            //- Price
            if product.price !== undefined
              .col-md-6
                .border.rounded.p-3.h-100
                  .d-flex.align-items-center
                    i.bi.bi-tag-fill.text-primary.fs-4.me-3
                    div
                      small.text-muted.d-block Giá bán
                      .fs-4.fw-bold.text-primary= product.price.toLocaleString('vi-VN') + 'đ'
            
            //- Discount
            if product.discountPercentage
              .col-md-6
                .border.rounded.p-3.h-100
                  .d-flex.align-items-center
                    i.bi.bi-percent.text-danger.fs-4.me-3
                    div
                      small.text-muted.d-block Giảm giá
                      .fs-4.fw-bold.text-danger= product.discountPercentage + '%'
            
            //- Stock
            if product.stock !== undefined
              .col-md-6
                .border.rounded.p-3.h-100
                  .d-flex.align-items-center
                    i.bi.bi-box-seam.text-info.fs-4.me-3
                    div
                      small.text-muted.d-block Tồn kho
                      .fs-4.fw-bold= product.stock
            
            //- Availability Status
            if product.availabilityStatus
              .col-md-6
                .border.rounded.p-3.h-100
                  .d-flex.align-items-center
                    i.bi.bi-check-circle-fill.fs-4.me-3(
                      class=product.availabilityStatus === "In Stock" ? "text-success" : "text-danger"
                    )
                    div
                      small.text-muted.d-block Trạng thái
                      div
                        if product.availabilityStatus === "In Stock"
                          span.badge.bg-success.fs-6 Còn hàng
                        else
                          span.badge.bg-danger.fs-6 Hết hàng
            
            //- Position
            if product.position !== undefined
              .col-md-6
                .border.rounded.p-3.h-100
                  .d-flex.align-items-center
                    i.bi.bi-sort-numeric-down.text-warning.fs-4.me-3
                    div
                      small.text-muted.d-block Vị trí hiển thị
                      .fs-4.fw-bold= product.position
          
          //- Description
          if product.description
            hr.my-4
            h5.fw-bold.mb-3
              i.bi.bi-card-text.me-2
              | Mô tả sản phẩm
            .description!= product.description

    //- Right Column - Meta Info
    .col-lg-4
      //- User Actions Card
      .card.shadow-sm.mb-3
        .card-header.bg-white
          h6.mb-0.fw-semibold
            i.bi.bi-people.me-2
            | Thông Tin Người Dùng
        .card-body
          if product.createdByFullName
            .mb-3
              small.text-muted.d-block
                i.bi.bi-person-plus.me-1
                | Người tạo
              .fw-semibold= product.createdByFullName
          
          if product.updatedByFullName
            .mb-3
              small.text-muted.d-block
                i.bi.bi-pencil-square.me-1
                | Người cập nhật
              .fw-semibold= product.updatedByFullName
          
          if product.deletedBy
            .mb-0
              small.text-muted.d-block
                i.bi.bi-trash.me-1
                | Người xóa
              .fw-semibold.text-danger= product.deletedBy

      //- Timeline Card
      .card.shadow-sm.mb-3
        .card-header.bg-white
          h6.mb-0.fw-semibold
            i.bi.bi-clock-history.me-2
            | Lịch Sử
        .card-body
          if product.createdAt
            .mb-3
              .d-flex
                .me-3
                  i.bi.bi-calendar-plus.fs-5.text-success
                div
                  small.text-muted.d-block Ngày tạo
                  .fw-semibold= new Date(product.createdAt).toLocaleString('vi-VN')
          
          if product.updatedAt
            .mb-3
              .d-flex
                .me-3
                  i.bi.bi-calendar-check.fs-5.text-info
                div
                  small.text-muted.d-block Cập nhật lần cuối
                  .fw-semibold= new Date(product.updatedAt).toLocaleString('vi-VN')
          
          if product.deleted && product.deletedAt
            .mb-0
              .d-flex
                .me-3
                  i.bi.bi-calendar-x.fs-5.text-danger
                div
                  small.text-muted.d-block Ngày xóa
                  .fw-semibold.text-danger= new Date(product.deletedAt).toLocaleString('vi-VN')

      //- Status Card
      .card.shadow-sm.mb-3
        .card-header.bg-white
          h6.mb-0.fw-semibold
            i.bi.bi-info-circle.me-2
            | Trạng Thái
        .card-body
          .d-flex.justify-content-between.align-items-center.mb-3
            span
              i.bi.bi-box.me-2
              | Sản phẩm
            if product.deleted
              span.badge.bg-danger Đã xóa
            else
              span.badge.bg-success Hoạt động
          
          if product.slug
            .d-flex.justify-content-between.align-items-center
              span
                i.bi.bi-link-45deg.me-2
                | Slug
              code.bg-light.px-2.py-1.rounded.small= product.slug

      //- Quick Actions
      .card.shadow-sm
        .card-header.bg-white
          h6.mb-0.fw-semibold
            i.bi.bi-lightning.me-2
            | Thao Tác
        .card-body
          .d-grid.gap-2
            a.btn.btn-warning(href=`${prefixAdmin}/products/edit/${product.id}`)
              i.bi.bi-pencil.me-2
              | Chỉnh Sửa
            
            if product.deleted
              button.btn.btn-success(
                type="button"
                onclick=`if(confirm('Khôi phục sản phẩm này?')) window.location.href='${prefixAdmin}/products/restore/${product.id}'`
              )
                i.bi.bi-arrow-counterclockwise.me-2
                | Khôi Phục
            else
              button.btn.btn-outline-danger(
                type="button"
                data-bs-toggle="modal"
                data-bs-target="#deleteModal"
              )
                i.bi.bi-trash.me-2
                | Xóa Sản Phẩm

  //- Delete Modal
  .modal.fade(id="deleteModal" tabindex="-1")
    .modal-dialog.modal-dialog-centered
      .modal-content
        .modal-header.border-0
          h5.modal-title
            i.bi.bi-exclamation-triangle.text-danger.me-2
            | Xác Nhận Xóa
          button.btn-close(type="button" data-bs-dismiss="modal")
        .modal-body
          p.mb-0 Bạn có chắc chắn muốn xóa sản phẩm 
            strong #{product.title}
            | ? Hành động này có thể hoàn tác.
        .modal-footer.border-0
          button.btn.btn-secondary(type="button" data-bs-dismiss="modal") Hủy
          a.btn.btn-danger(href=`${prefixAdmin}/products/delete/${product.id}`)
            i.bi.bi-trash.me-2
            | Xóa