extends ../../layout/default.pug
include ../../mixins/select-tree.pug

block main

  
  //- Page Header
  .d-flex.justify-content-between.align-items-center.mb-4
    div
      h2.fw-bold.mb-1
        i.bi.bi-pencil-square.me-2.text-warning
        | Chỉnh Sửa Bài Viết
      p.text-muted.mb-0 Cập nhật nội dung và cấu hình bài viết
    a.btn.btn-outline-secondary(href=`${prefixAdmin}/posts`)
      i.bi.bi-arrow-left.me-2
      | Quay Lại

  //- Form
  form(
    action=`${prefixAdmin}/posts/edit/${post._id}?_method=PATCH`
    method="POST"
    enctype="multipart/form-data"
    id="form-edit-post"
  )
    .row
      //- Left Column (Nội dung chính)
      .col-lg-8
        //- Basic Info Card
        .card.mb-3.border-0.shadow-sm
          .card-header.bg-white
            h6.mb-0.fw-semibold
              i.bi.bi-card-text.me-2
              | Nội Dung Bài Viết
          .card-body
            //- Title
            .mb-3
              label.form-label.fw-semibold(for="title")
                | Tiêu đề bài viết
                span.text-danger *
              input.form-control(
                type="text"
                id="title"
                name="title"
                placeholder="Nhập tiêu đề bài viết..."
                value=post.title
                required
              )
            
            //- Category
            .mb-3
              label.form-label.fw-semibold(for="post_category_id")
                i.bi.bi-diagram-3.me-1
                | Danh mục bài viết
              select.form-select(
                id="post_category_id"
                name="post_category_id"
              )
                option(value="") -- Chọn danh mục --
                if listCategory
                  //- Tham số thứ 3 là id của danh mục hiện tại để tự động 'selected'
                  +select-tree(listCategory, 0, post.post_category_id)
            
            //- Short Description
            .mb-3
              label.form-label.fw-semibold(for="desc") Mô tả ngắn (Sapo)
              textarea.form-control(
                id="desc"
                name="description"
                rows="3"
                placeholder="Tóm tắt nội dung..."
              ) #{post.description}

            //- Main Content (TinyMCE)
            .mb-3
              label.form-label.fw-semibold(for="content")
                i.bi.bi-file-richtext.me-1
                | Nội dung chi tiết
              textarea.form-control.tinymce(
                id="content"
                name="content"
                rows="15"
              ) !{post.content} 

      //- Right Column (Cấu hình)
      .col-lg-4
        //- Image Card
        .card.mb-3.border-0.shadow-sm
          .card-header.bg-white
            h6.mb-0.fw-semibold
              i.bi.bi-image.me-2
              | Hình Ảnh
          .card-body
            label.form-label.fw-semibold(for="thumbnail") Ảnh đại diện
            
            //- Current Image
            if post.thumbnail
              .mb-3.text-center
                p.text-muted.small Ảnh hiện tại:
                img.img-thumbnail.rounded(
                  src=post.thumbnail
                  alt=post.title
                  style="max-width: 100%"
                )

            //- Upload Area
            .upload-image
              .border.border-2.border-dashed.rounded.p-4.text-center.mb-3.bg-light
                input.d-none(
                  type="file"
                  id="thumbnail"
                  name="thumbnail"
                  accept="image/*"
                  upload-image-input
                )
                label.d-block(for="thumbnail" style="cursor: pointer")
                  i.bi.bi-cloud-upload.display-4.text-primary.d-block.mb-2
                  p.mb-1.fw-semibold Click để đổi ảnh
                  small.text-muted Kéo thả ảnh vào đây
                  br
                  small.text-muted PNG, JPG (Max: 2MB)
              
              //- Preview New Image
              .form-imagePreview.d-none.text-center
                button.btn-close(type="button" btn-remove-imagePreview)
                img.img-thumbnail.rounded(
                  src=""
                  alt="Preview"
                  upload-image-preview
                  style="max-width: 100%"
                )

        //- Settings Card
        .card.mb-3.border-0.shadow-sm
          .card-header.bg-white
            h6.mb-0.fw-semibold
              i.bi.bi-gear.me-2
              | Cài Đặt & Xuất Bản
          .card-body
            //- Position
            .mb-3
              label.form-label.fw-semibold(for="position")
                i.bi.bi-sort-numeric-down.me-1
                | Vị trí
              input.form-control(
                type="number"
                id="position"
                name="position"
                min="1"
                value=post.position
              )

            //- Featured (Nổi bật)
            .mb-3
              label.form-label.fw-semibold.d-block.mb-2
                i.bi.bi-star.me-1
                | Đánh dấu nổi bật
              
              .form-check.form-switch
                input.form-check-input(
                  type="checkbox"
                  id="featured"
                  name="featured"
                  value="1"
                  checked=(post.featured === "1")
                )
                label.form-check-label(for="featured") Tin nổi bật

            hr.text-muted

            //- Status
            .mb-3
              label.form-label.fw-semibold.d-block.mb-2
                i.bi.bi-toggle-on.me-1
                | Trạng thái
              
              .form-check.border.rounded.p-3.mb-2
                input.form-check-input(
                  type="radio"
                  id="statusActive"
                  name="status"
                  value="active"
                  checked=(post.status === "active")
                )
                label.form-check-label.ms-2(for="statusActive")
                  i.bi.bi-eye-fill.text-success
                  |  Hiển thị ngay

              .form-check.border.rounded.p-3
                input.form-check-input(
                  type="radio"
                  id="statusInActive"
                  name="status"
                  value="inactive"
                  checked=(post.status === "inactive")
                )
                label.form-check-label.ms-2(for="statusInActive")
                  i.bi.bi-eye-slash-fill.text-secondary
                  |  Bản nháp (Ẩn)

    //- Actions
    .card.border-0.shadow-sm.mt-4
      .card-body
        .d-flex.justify-content-between.align-items-center
          div
            a.btn.btn-outline-danger(href=`${prefixAdmin}/posts`)
              i.bi.bi-x-circle.me-2
              | Hủy Bỏ
            button.btn.btn-outline-secondary.ms-2(
              type="button"
              onclick="history.back()"
            )
              i.bi.bi-arrow-left.me-2
              | Quay Lại
          
          button.btn.btn-warning.btn-lg.text-white(type="submit")
            i.bi.bi-check-circle.me-2
            | Cập Nhật Bài Viết